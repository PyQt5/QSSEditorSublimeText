#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
Created on 2022/05/26
@author: Irony
@site: https://pyqt.site https://github.com/PyQt5
@email: 892768447@qq.com
@file: Utils.py
@description:
"""
import logging
import os

import coloredlogs
import sublime

PLUGIN_NAME = 'QSSEditor'
SETTINGS_FILENAME = '{0}.sublime-settings'.format(PLUGIN_NAME)


def init_log(file=None, name=PLUGIN_NAME, level=logging.DEBUG, formatter=None):
    """
    初始化日志记录配置
    :param file: 文件名
    :param name: 日志名
    :param level: 日志级别
    :param formatter: 日志格式
    """
    # 修改时间格式化中的,为.
    logging.Formatter.default_msec_format = '%s.%03d'
    formatter = formatter or logging.Formatter(
        '[%(asctime)s] %(levelname)-8s [%(module)s:%(funcName)s:%(lineno)s] %(message)s'
    )
    # if level == logging.DEBUG else '[%(asctime)s %(name)s] %(levelname)-8s %(message)s')

    logger = logging.getLogger(name)
    logger.setLevel(level)

    # 安装彩色输出
    coloredlogs.install(fmt=formatter._fmt, level=level, logger=logger)

    # # 控制台流输出
    # stream_handler = logging.StreamHandler()
    # stream_handler.setFormatter(formatter)
    # logger.addHandler(stream_handler)

    # 文件日志
    if file:
        file = os.path.abspath(file)
        file_handler = logging.FileHandler(file, mode='w', encoding='gb18030')
        file_handler.setFormatter(formatter)
        logger.addHandler(file_handler)


def get_setting(view, key, default=None):
    """
    获取设置
    :param view: sublime.View
    :param key: 键名
    :param default: 默认值
    """
    settings = view.settings().get(PLUGIN_NAME) if view else None
    if settings is None or settings.get(key) is None:
        settings = sublime.load_settings(SETTINGS_FILENAME)
    return settings.get(key, default)
